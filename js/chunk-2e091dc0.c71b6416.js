(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e091dc0"],{3891:function(e,t,a){"use strict";a.r(t);var l=a("7a23");const c={class:"create-post-page"},n={class:"margin-start"},i=Object(l["p"])("h2",null,"点击上传头图",-1),o=Object(l["p"])("div",{class:"spinner-border",role:"status"},[Object(l["p"])("span",{class:"visually-hidden"},"Loading...")],-1),s=Object(l["p"])("h2",{class:"text-primary"},"正在加载中...",-1),r=Object(l["p"])("h2",{class:"text-primary"},"上传出错",-1),u={class:"mb-3"},d=Object(l["p"])("label",{class:"form-label"},"文章标题",-1),b={class:"mb-3"},p=Object(l["p"])("label",{for:"exampleInputPassword1",class:"form-label"},"文章详情",-1),f={class:"btn btn-primary btn-large"};function O(e,t,a,O,j,m){const v=Object(l["P"])("Uploader"),g=Object(l["P"])("validate-input"),h=Object(l["P"])("validate-form");return Object(l["G"])(),Object(l["k"])("div",c,[Object(l["p"])("h4",n,Object(l["T"])(e.isEditMode?"编辑文章":"新建文章"),1),Object(l["p"])(v,{action:"http://apis.imooc.com/api/upload",onFileUploaded:e.handleFileUploaded,beforeUpData:e.beforeUpData,uploaded:e.uploadedImageData,class:"d-flex align-items-center justify-content-center bg-light text-secondary w-100 my-4"},{loading:Object(l["fb"])(()=>[o,s]),success:Object(l["fb"])(e=>[Object(l["p"])("img",{src:e.uploadedData,alt:"jpg"},null,8,["src"])]),error:Object(l["fb"])(()=>[r]),default:Object(l["fb"])(()=>[i]),_:1},8,["action","onFileUploaded","beforeUpData","uploaded"]),Object(l["p"])(h,{onFormSubmit:e.submitFn},{submit:Object(l["fb"])(()=>[Object(l["p"])("button",f,Object(l["T"])(e.isEditMode?"更新文章":"发表文章"),1)]),default:Object(l["fb"])(()=>[Object(l["p"])("div",u,[d,Object(l["p"])(g,{rule:e.tliteRules,modelValue:e.val.tliteValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.val.tliteValue=t),type:"text",placeholder:"请输入文章标题"},null,8,["rule","modelValue"])]),Object(l["p"])("div",b,[p,Object(l["p"])(g,{rule:e.textRules,modelValue:e.val.textValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.val.textValue=t),tag:"textarea",rows:"10",placeholder:"请输入文章详情"},null,8,["rule","modelValue"])])]),_:1},8,["onFormSubmit"])])}var j=a("b0f8"),m=a("3200"),v=a("5502"),g=a("7759"),h=a("dc3c"),y=a("6c02");const U=Object(l["p"])("button",{class:"btn btn-primary",disabled:""},"正在上传...",-1),D=Object(l["p"])("button",{class:"btn btn-primary"},"上传成功",-1),V=Object(l["p"])("button",{class:"btn btn-primary"},"上传出错",-1),k=Object(l["p"])("button",{class:"btn btn-primary"},"点击上传",-1);function x(e,t,a,c,n,i){return Object(l["G"])(),Object(l["k"])(l["b"],null,[Object(l["p"])("div",Object(l["w"])({onClick:t[1]||(t[1]=Object(l["ib"])((...t)=>e.fileBtnClick&&e.fileBtnClick(...t),["prevent"]))},e.$attrs,{class:"file-upload-container"}),["loading"===e.filesStates?Object(l["O"])(e.$slots,"loading",{key:0},()=>[U]):"success"===e.filesStates?Object(l["O"])(e.$slots,"success",{key:1,uploadedData:e.uploadedData},()=>[D]):"error"===e.filesStates?Object(l["O"])(e.$slots,"error",{key:2},()=>[V]):Object(l["O"])(e.$slots,"default",{key:3},()=>[k])],16),Object(l["p"])("input",{type:"file",name:"fileOne",ref:"fileInput",class:"d-none file-input",onChange:t[2]||(t[2]=(...t)=>e.handleFileChange&&e.handleFileChange(...t))},null,544)],64)}var F=a("9ab4"),w=a("bc3a"),C=a.n(w),q=Object(l["q"])({name:"Uploader",props:{action:{type:String,required:!0},beforeUpData:{type:Function},uploaded:{type:Object}},inheritAttrs:!1,emits:["fileUploaded","uploadedError"],setup:function(e,t){var a=this,c=Object(l["L"])(e.uploaded),n=Object(l["L"])(e.uploaded?"success":"ready");Object(l["db"])((function(){return e.uploaded}),(function(e){e&&(n.value="success",c.value=e.data.url)}));var i=Object(l["L"])(null),o=function(){i.value&&i.value.click()},s=function(l){return Object(F["b"])(a,void 0,void 0,(function(){var a,o,s,r,u;return Object(F["c"])(this,(function(d){switch(d.label){case 0:return a=l.target,o=a.files,o?(s=Array.from(o),e.beforeUpData&&(r=e.beforeUpData(s[0]),!r)?(n.value="error",[2]):(n.value="loading",u=new FormData,u.append("file",s[0]),[4,C.a.post(e.action,u,{headers:{"Content-Type":"multipart/from-data"}}).then((function(e){t.emit("fileUploaded",e.data),c.value=e.data.data.url,n.value="success"})).catch((function(e){console.log(e),n.value="error"})).finally((function(){i.value&&(i.value.value="")}))])):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))};return{fileBtnClick:o,fileInput:i,filesStates:n,handleFileChange:s,uploadedData:c}}});q.render=x;var S=q,I=Object(l["q"])({name:"CreatePost",components:{ValidateForm:j["a"],ValidateInput:m["a"],Uploader:S},setup:function(){var e=Object(y["d"])(),t=Object(y["c"])(),a=!!t.query.id,c=Object(v["b"])(),n=Object(l["L"])(),i=[{type:"required",message:"文章标题不能为空"}],o=[{type:"required",message:"文章详情不能为空"}],s=Object(l["K"])({tliteValue:"",textValue:""});Object(l["D"])((function(){a&&c.dispatch("postDetailRst",t.query.id).then((function(e){e.image&&(n.value={data:e.image}),s.tliteValue=e.title,s.textValue=e.content||""}))}));var r="",u=function(e){e.data._id&&(r=e.data._id)},d=function(l){if(l){var n=c.state.user,i=n.column,o=n._id;if(i){var u={column:""+i,title:s.tliteValue,content:s.textValue,author:""+o};r&&(u.image=r);var d=a?"updatePost":"postDetailRst",b=a?{id:t.query.id,payload:u}:u;c.dispatch(d,b).then((function(){Object(h["a"])("发表成功, 2秒后跳转到文章","success",2e3),setTimeout((function(){e.push({name:"columnDetail",params:{id:i}})}),2e3)}))}}},b=function(e){var t=["image/jpeg","image/png"],a=Object(g["b"])(e,{format:t,size:1});return a.passed?Object(h["a"])("上传成功","success"):"format"===a.error?Object(h["a"])("上传图片只能是image/jpeg格式","error"):Object(h["a"])("上传图片大小超出1M","error"),a.passed},p=function(e){Object(h["a"])("上传成功，成功id为："+e.data._id,"success")};return{tliteRules:i,textRules:o,val:s,submitFn:d,onfileUploaded:p,beforeUpData:b,handleFileUploaded:u,uploadedImageData:n,isEditMode:a}}});a("e333");I.render=O;t["default"]=I},"6f48":function(e,t,a){},e333:function(e,t,a){"use strict";a("6f48")}}]);
//# sourceMappingURL=chunk-2e091dc0.c71b6416.js.map